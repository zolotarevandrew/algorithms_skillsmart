1) функция определения следующего шага
на входе текущий шаг на выходе следующий
лифтим используя стейт машину для поиска в глубину, на выходе получаем шаг.

2) Функция преобразования строки гугл адреса
типичный пример, когда строку проще разбить на составляюшие и потом обработать
(строки могут содержать другие точки с запятой или запятые, используем дополнительный regex)

3) Работа с динамическими данными через JObject - удаляем персональные поля (санитизация) 

Итого - интересный паттерн из функциональных языков, 
здесь еще раз подтверждаются мысли о мышлении на более высоком уровне и использовании
специфичных алгоритмов и подходов. С помощью которых, кажется, можно избавится от кучи не нужных if-ов и значительно снизить цикломатическую сложность.